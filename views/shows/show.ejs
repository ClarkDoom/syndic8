<%- include('../partials/html-head') %>
<%- include('../partials/nav') %>

<div class="container">
  <div class="row vstack">

    <div class="col text-center justify-content-center">
      <h3>Show Details</h3>
    </div>
  
    <div class="col text-center">
      <%= show.name %><br>
      <img width=10%" src="https://www.themoviedb.org/t/p/w300_and_h450_bestv2/<%= show.imageUrl %>" alt=""><br>
      <%= show.description %>
    </div>

    <% if (show.addedBy.equals(user.profile._id)) { %>
     
    
    

    <div class="col text-center">
      <form 
      id="add-review-form"
      action="/shows/<%= show._id %>/reviews"
      method="POST"
      >
        <table>
          <thead>
            <tr>
              <th><label for="review-title">Review Title:</label></th>
              <th><label for="review-content">Review:</label></th>
              <th><label for="rating-select">Rating:</label></th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><input placeholder="Review Title" type="text" name="reviewTitle" id="review-title"></td>
              <td><textarea placeholder="Enter Review Here" name="reviewContent" id="reviewContent" cols="30" rows="10"></textarea></td>
              <td>
                <select name="rating" id="rating-select">
                  <option value="1">.5</option>
                  <option value="1">1</option>
                  <option value="1">1.5</option>
                  <option value="2">2</option>
                  <option value="2">2.5</option>
                  <option value="3">3</option>
                  <option value="3">3.5</option>
                  <option value="4">4</option>
                  <option value="4">4.5</option>
                  <option value="5">5</option>
                </select>
              </td>
              <input class="hidden" value="<%= show.name %>" name="showTitle" type="text">
              <input class="hidden" value="<%= show.addedBy.userName %>" name="author" type="text">
              <td><button type="submit">submit</button></td>
            </tr>
          </tbody>
        </table>  
      <% } %>

        <!-- FANCING RATING - IMPLEMENT AFTER MVP  -->
        <!-- <label class="rating-label">
          <strong>Rating</strong>
          <input
            class="rating"
            max="5"
            oninput="this.style.setProperty('--value', this.value)"
            step="0.5"
            type="range"
            value="1">
        </label> -->

      </form>
    </div>


    <div class="col text-center">
      <% if (show.reviews.length) { %>
        <table>
          <thead>
            <tr>
              <th>Review Title</th>
              <th>Review</th>
              <th>Rating</th>
              <th></th>
              <th></th>
              
            </tr>
          </thead>
          <tbody>
            <% let total = 0 %> 
            <% show.reviews.forEach(function(review) { %>
              <% total += review.rating %>
              <tr>
                <td><a href="/shows/<%= show._id %>/<%= review._id %>"><%= review.reviewTitle %></a></td>
                <td><%= review.reviewContent %></td>
                <td><%= review.rating %> </td>
                <% if (show.addedBy.equals(user.profile._id)) { %>
                  <td><a href="/shows/<%= show._id %>/<%= review._id %>/edit">Edit</a></td>
                  <td> <form 
                      action="/shows/<%= show._id %>/<%= review._id %>?_method=DELETE" 
                      method="POST"
                    >
                      <button>Delete</button>
                    </form>
                  </td>
                <% } else { %> 
                  <td></td>
                  <td></td>
                <% } %> 
                
              </tr>
            <% }) %>
          </tbody>
        </table>
      <% } else { %>
        <h3>No Reviews Yet</h3>
      <% } %>
    </div>

  </div>
</div>

<!-- <label class="rating-label">
  <strong>Rating</strong>
  <input
    class="rating"
    max="5"
    oninput="this.style.setProperty('--value', this.value)"
    step="0.5"
    type="range"
    value="1">
</label>
<br> -->

<%- include('../partials/footer') %>